generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  username     String   @unique
  passwordHash String
  name         String
  searchable   Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  disrespects     Disrespect[]
  wins            Win[]
  friendsAsUser   Friendship[]   @relation("UserFriends")
  friendsAsFriend Friendship[]   @relation("FriendOfUser")
  sessions        Session[]
  passwordResets  PasswordReset[]
  invites         Invite[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Disrespect {
  id        String   @id @default(cuid())
  userId    String
  category  String   // "credit_theft" | "thrown_under_bus" | "ghosted" | "general_clowning"
  note      String?
  weekStart DateTime // Monday of the week this belongs to
  isShared  Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, weekStart])
}

model Win {
  id        String   @id @default(cuid())
  userId    String
  category  String   // "clutch_moment" | "had_your_back" | "real_talk" | "goat_behavior"
  note      String?
  weekStart DateTime // Monday of the week this belongs to
  isShared  Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, weekStart])
}

model Friendship {
  id        String   @id @default(cuid())
  userId    String
  friendId  String
  status    String   @default("pending") // "pending" | "accepted"
  createdAt DateTime @default(now())

  user   User @relation("UserFriends", fields: [userId], references: [id], onDelete: Cascade)
  friend User @relation("FriendOfUser", fields: [friendId], references: [id], onDelete: Cascade)

  @@unique([userId, friendId])
}

model Invite {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
